{% extends "asset_mgt_app/base.html" %}
{% load widget_tweaks %}
{% block content %}

<div class="container-fluid row">
	<div class="col-md-1">
		<a href="{% url 'pk_quotation_cancel' %}" class="btn btn-primary btn-block btn-lg">
			<i class="fas fa-arrow-left"></i> Back
		</a>
	</div>
	<!--    <div class="col-md-1.5">-->
	<!--        <a href="{% url 'pk_quotation_insert' %}" class="btn btn-success btn-block btn-lg">-->
	<!--            <i class="fas fa-plus"></i> Add Items-->
	<!--        </a>-->
	<!--    </div>-->
</div>
<div class="row">
	<div class="col-1"></div>
	<div class="col-8">
		<form method="POST" action="" id="quotation_add" data-stock_description-url="{% url 'load_stock_description' %}"  >
			{% csrf_token %}
			<div class="container-fluid">
				<div class="card text-white bg-info mb-3" style="max-width: 100%;">
					<div class="card-header text-center"><h3>Add/Update Quotation</h3></div>
					<div class="card-body bg-light" id="quotation_form">
						<div class="row" >
							<div class="col-6">
								<div class="input-group input-group-sm mb-3">
									<div class="input-group-prepend">
										<span class="input-group-text">Assessment Number</span>
									</div>
									{% render_field form.pkqt_assessment_num id="pkqt_assessment_num"  class="form-control disable_a_href" %}
								</div>
								<div class="input-group input-group-sm mb-3">
									<div class="input-group-prepend">
										<span class="input-group-text">Customer Name</span>
									</div>
									{% render_field form.pkqt_customer_name id="pkqt_customer_name"  class="form-control disable_a_href" %}
								</div>
								<div class="input-group input-group-sm mb-3">
									<div class="input-group-prepend">
										<span class="input-group-text">Cost Type</span>
									</div>
									{% render_field form.pkqt_cost_type id="pkqt_cost_type" onchange="onChangeHandler()" class="form-control" %}
								</div>
								<div class="input-group input-group-sm mb-3">
									<div class="input-group-prepend">
										<span class="input-group-text">Item Name</span>
									</div>
									{% render_field form.pkqt_requirement id="pkqt_requirement" onchange="pk_store_na_dimension_id()" class="form-control disable_a_href" %}
								</div>
								<div class="input-group input-group-sm mb-3">
									<div class="input-group-prepend">
										<span class="input-group-text">Requirement Name & Size</span>
									</div>
									{% render_field form.pkqt_requirement_size id="pkqt_requirement_size" class="form-control disable_a_href" %}
								</div>
								<div class="input-group input-group-sm mb-3">
									<div class="input-group-prepend">
										<span class="input-group-text">Stock Type</span>
									</div>
									{% render_field form.pkqt_stock_type id="pkqt_stock_type" onchange="change_cost_type()" class="form-control disable_a_href" %}
								</div>
								<div class="input-group input-group-sm mb-3">
									<div class="input-group-prepend">
										<span class="input-group-text">Stock Description</span>
									</div>
									{% render_field form.pkqt_stock_description id="pkqt_stock_description" onchange="change_cost_type()" class="form-control disable_a_href" %}
								</div>
								<div class="input-group input-group-sm mb-3">
									<div class="input-group-prepend">
										<span class="input-group-text">Item</span>
									</div>
									{% render_field form.pkqt_item id="pkqt_item" onchange="change_cost_type()" class="form-control disable_a_href" %}
								</div>

								<div class="input-group input-group-sm mb-3">
									<div class="input-group-prepend">
										<span class="input-group-text">Item Description</span>
									</div>
									{% render_field form.pkqt_itemdescription id="pkqt_itemdescription" onchange="change_cost_type()" class="form-control disable_a_href" %}
								</div>

								<div class="row ">
									<div class="col-9">
										<div class="input-group input-group-sm mb-3">
											<div class="input-group-prepend">
												<span class="input-group-text">Height_requested<i class="fas fa-info-circle" data-toggle="tooltip" data-placement="top" title="For Wood MM. For Plywood Inch"></i></span>
											</div>
											{% render_field form.pkqt_height_req id="pkqt_height_req" onchange="change_cost_type()" class="form-control disable_a_href" %}
										</div>
										<div class="input-group input-group-sm mb-3">
											<div class="input-group-prepend">
												<span class="input-group-text">Width_requested (inch)</span>
											</div>
											{% render_field form.pkqt_width_req id="pkqt_width_req" onchange="change_cost_type()" class="form-control disable_a_href" %}
										</div>
										<div class="input-group input-group-sm mb-3">
											<div class="input-group-prepend">
												<span class="input-group-text">Length_requested<i class="fas fa-info-circle" data-toggle="tooltip" data-placement="top" title="For Wood Feet. For Plywood Inch"></i></span>
											</div>
											{% render_field form.pkqt_length_req id="pkqt_length_req" onchange="change_cost_type()" class="form-control disable_a_href" %}
										</div>
										<div class="input-group input-group-sm mb-3">
											<div class="input-group-prepend">
												<span class="input-group-text">Quantity_requested</span>
											</div>
											{% render_field form.pkqt_quantity_req id="pkqt_quantity_req" onchange="change_cost_type()" class="form-control disable_a_href" %}
										</div>
										<div class="input-group input-group-sm mb-3">
											<div class="input-group-prepend">
												<span class="input-group-text">CFT/Sqft_requested<i class="fas fa-info-circle" data-toggle="tooltip" data-placement="top" title="For wood CFT. For Consumables, Plywood SQFT"></i></span>
											</div>
											{% render_field form.pkqt_sqrt_req id="pkqt_sqrt_req" onchange="change_cost_type()" class="form-control disable_a_href" %}
										</div>

									</div>
									<div class="col-3 d-flex align-items-center justify-content-center">
										<button id="search_wood" type="button" class="btn btn-warning btn-lg"><i class="fas fa-search"></i> Search Item</button>
									</div>
								</div>
							</div>
							<div class="col-6">
								<div class="company-side border border-danger rounded p-3" style="border-width: 225px;">
									<div class="input-group input-group-sm mb-3">
										<div class="input-group-prepend">
											<span class="input-group-text">Height_available (inch)</span>
										</div>
										{% render_field form.pkqt_height id="pkqt_height" class="form-control disable_a_href" %}
									</div>
									<div class="input-group input-group-sm mb-3">
										<div class="input-group-prepend">
											<span class="input-group-text">Width_available (inch)</span>
										</div>
										{% render_field form.pkqt_width id="pkqt_width" class="form-control disable_a_href" %}
									</div>
									<div class="input-group input-group-sm mb-3">
										<div class="input-group-prepend">
											<span class="input-group-text">Length_available (Ft)</span>
										</div>
										{% render_field form.pkqt_length id="pkqt_length" class="form-control disable_a_href" %}
									</div>
									<div class="input-group input-group-sm mb-3">
										<div class="input-group-prepend">
											<span class="input-group-text">UOM</span>
										</div>
										{% render_field form.pkqt_uom id="pkqt_uom" class="form-control " %}
									</div>
									<div class="input-group input-group-sm mb-3">
										<div class="input-group-prepend">
											<span class="input-group-text">Size</span>
										</div>
										{% render_field form.pkqt_size id="pkqt_size" class="form-control disable_a_href" %}
									</div>
									<div class="input-group input-group-sm mb-3">
										<div class="input-group-prepend">
											<span class="input-group-text">Quantity</span>
										</div>
										{% render_field form.pkqt_quantity id="pkqt_quantity" onchange="change_cost_type()" class="form-control " %}
									</div>
									<div class="input-group input-group-sm mb-3">
										<div class="input-group-prepend">
											<span class="input-group-text">Total CFT/SQFT (Available)</span>
										</div>
										{% render_field form.pkqt_cft id="pkqt_cft" onchange="change_cost_type()" class="form-control disable_a_href" %}
									</div>
									<div class="input-group input-group-sm mb-3">
										<div class="input-group-prepend">
											<span class="input-group-text">Stock Purchase Number</span>
										</div>
										{% render_field form.pkqt_stock_purchase_number id="pkqt_stock_purchase_number" class="form-control disable_a_href" %}
									</div>
									<div class="input-group input-group-sm mb-3">
										<div class="input-group-prepend">
											<span class="input-group-text">Rate/Qty (CFT)</span>
										</div>
										{% render_field form.pkqt_rate id="pkqt_rate" onchange="change_cost_type()" class="form-control" %}
									</div>
								</div>
								<br>
								<div class="input-group input-group-sm mb-3">
									<div class="input-group-prepend">
										<span class="input-group-text">Days/Hours</span>
									</div>
									{% render_field form.pkqt_days id="pkqt_days" onchange="change_cost_type()" class="form-control " %}
								</div>
								<div class="input-group input-group-sm mb-3">
									<div class="input-group-prepend">
										<span class="input-group-text">Unit Cost(INR)</span>
									</div>
									{% render_field form.pkqt_total_cost id="pkqt_total_cost" readonly="True" class="form-control disable_a_href" %}
								</div>
								<div class="input-group input-group-sm mb-3">
									<div class="input-group-prepend">
										<span class="input-group-text">Total Cost(INR)</span>
									</div>
									{% render_field form.pkqt_totalbox_cost id="pkqt_totalbox_cost" readonly="True" class="form-control disable_a_href" %}
								</div>
								{% render_field form.pkqt_updated_by id="pkqt_updated_by" hidden="True" class="form-control" %}
							</div>
						</div>
						<div class="row">
							<div class="col-1"></div>
							<div class="col-10">
								<div class="message text-center">
									{% for message in messages %}
									<a {% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</a>
									{% endfor %}
								</div>
							</div>
							<div class="col-1"></div>
						</div>
						<button type="submit" class="btn btn-success "><i class="fas fa-check"></i> Submit</button>
						<a href="{% url 'pk_quotation_cancel' %}" class="btn btn-danger float-right">
							<i class="fas fa-times"></i> Cancel
						</a>
					</div>
				</div>
			</div>
		</form>
	</div>
	<div class="col-3 ">
		{% include "asset_mgt_app/calculation_card.html" %}
	</div>
</div>
<div id="pk_item_search_page_costing">
	{% include "asset_mgt_app/pk_item_search_page_costing.html" %}
</div>

{% include "asset_mgt_app/pk_quotation_list_WOH.html" %}

<script>
	$(document).ready(function() {
        var assessment_num=document.getElementById("pkqt_assessment_num").value;
        var customer_name=document.getElementById("pkqt_customer_name").value;
        var user_id=document.getElementById("pkqt_updated_by").value;
        if (user_id=="")
        {
            document.getElementById("pkqt_updated_by").value ='{{user_id}}';
        }
        else
        {
            document.getElementById("pkqt_updated_by").value =user_id;
        }

        if (assessment_num=="")
            {
                document.getElementById("pkqt_assessment_num").value ='{{na_assessment_num_id}}';
            }
        else
            {
                document.getElementById("pkqt_assessment_num").value =assessment_num;
            }

        if (customer_name=="")
            {
                document.getElementById("pkqt_customer_name").value ='{{na_customer_name_id}}';
            }
        else
            {
                document.getElementById("pkqt_customer_name").value = customer_name;
            }
        change_cost_type();
        $("#search_wood").on("click", function() {
                search_wood();
            });
        pk_store_na_dimension_id();
        });
</script>

<script>
	$("#pkqt_stock_type").change(function () {
       var url = $("#quotation_add").attr("data-stock_description-url");
       var stock_type = $(this).val();
       if (stock_type == 1 || stock_type == 4)
       {
         $('#pkqt_item').removeClass('disable_a_href');
         $('#pkqt_width_req').removeClass('disable_a_href');
         $('#pkqt_height_req').removeClass('disable_a_href');
         $('#pkqt_length_req').removeClass('disable_a_href');
         $('#pkqt_quantity_req').removeClass('disable_a_href');
       }
       else if (stock_type == 2){
         $('#pkqt_item').addClass('disable_a_href');
         $('#pkqt_width_req').addClass('disable_a_href');
         $('#pkqt_height_req').addClass('disable_a_href');
         $('#pkqt_length_req').addClass('disable_a_href');
         $('#pkqt_quantity_req').removeClass('disable_a_href');
       }
       else
       {
         $('#pkqt_item').addClass('disable_a_href');
         $('#pkqt_width_req').addClass('disable_a_href');
         $('#pkqt_height_req').addClass('disable_a_href');
         $('#pkqt_length_req').addClass('disable_a_href');
         $('#pkqt_quantity_req').addClass('disable_a_href');
       }
       $.ajax({
         url: url,
         data: {
           'stock_type': stock_type,
         },
         success: function (data) {
             console.log(data);
             $('#pkqt_stock_description').removeClass('disable_a_href');
             $("#pkqt_stock_description").empty();
             $('#pkqt_stock_description').empty().append("<option value='0'>--Select--</option>");
             var pkqt_stock_description_name=JSON.parse(data)["stock_description"];
             var pkqt_stock_description_id=JSON.parse(data)["stock_description_id"];
             var len = (pkqt_stock_description_id).length;
             $('#pkqt_stock_description').empty().append("<option value='0'>--Select--</option>");
             for( var i = 0; i<len; i++){
                 $("#pkqt_stock_description").append("<option value='"+pkqt_stock_description_id[i]+"'>"+pkqt_stock_description_name[i]+"</option>");
             }
         }
       });
     });
</script>

<script>
	function change_cost_type() {
            var jn=document.getElementById("pkqt_cost_type").value
            if ( jn==8)
            {
                $('#pkqt_item').addClass('disable_a_href');
                $('#pkqt_itemdescription').addClass('disable_a_href');
        		$('#pkqt_stock_type').removeClass('disable_a_href');
                var jn1=document.getElementById("pkqt_stock_type").value
                if ( jn1==1)
                {
                	$('#pkqt_item').removeClass('disable_a_href');
                    $('#pkqt_itemdescription').removeClass('disable_a_href');
            		$('#pkqt_stock_description').removeClass('disable_a_href');
    <!--				$('#pkqt_length').removeClass('disable_a_href');-->
    <!--				$('#pkqt_width').removeClass('disable_a_href');-->
    <!--				$('#pkqt_height').removeClass('disable_a_href');-->
                    $('#pkqt_uom').addClass('disable_a_href');
                    $('#pkqt_quantity').removeClass('disable_a_href');
                    $('#pkqt_sqrt_req').addClass('disable_a_href');
    <!--				$('#pkqt_size').addClass('disable_a_href');-->
    <!--				document.getElementById("pkqt_size").value=parseFloat(0.0)-->
                    $('#pkqt_days').addClass('disable_a_href');
                    document.getElementById("pkqt_days").value=0;

                    var length = parseFloat(document.getElementById("pkqt_length").value) || 0;
                    var height = parseFloat(document.getElementById("pkqt_height").value) || 0;
                    var width = parseFloat(document.getElementById("pkqt_width").value) || 0;
                    var rate = parseFloat(document.getElementById("pkqt_rate").value) || 0;
                    var quantity = parseInt(document.getElementById("pkqt_quantity").value) || 0;
                    var cft = (length*height*width/144)*quantity;
                    document.getElementById("pkqt_cft").value=cft.toFixed(2)

                    var length_req = parseFloat(document.getElementById("pkqt_length_req").value) || 0;
                    var width_req = parseFloat(document.getElementById("pkqt_width_req").value) || 0;
                    var height_req = parseFloat(document.getElementById("pkqt_height_req").value) || 0;
                    var quantity_req = parseFloat(document.getElementById("pkqt_quantity_req").value) || 0;
                    var cft_req = (length_req*width_req*height_req/144)*quantity_req;
                    document.getElementById("pkqt_sqrt_req").value=cft_req.toFixed(2)

                    var totalCost = rate * cft_req;
                    document.getElementById("pkqt_total_cost").value=totalCost.toFixed(2)
                    var totalboxCost = totalCost * quantity;
                    document.getElementById("pkqt_totalbox_cost").value=totalboxCost.toFixed(2)
                }
                else if ( jn1==4)
                {
                        $('#pkqt_item').addClass('disable_a_href');
          			    $('#pkqt_item').prop('disabled', true); // Disable the option
          			    $('#pkqt_itemdescription').addClass('disable_a_href');
          			    $('#pkqt_itemdescription').prop('disabled', true); // Disable the option
            			$('#pkqt_stock_description').removeClass('disable_a_href');
						$('#pkqt_uom').addClass('disable_a_href');
						$('#pkqt_quantity').removeClass('disable_a_href');
						$('#pkqt_sqrt_req').addClass('disable_a_href');
						$('#pkqt_height_req').addClass('disable_a_href');
						$('#pkqt_itemdescription').addClass('disable_a_href');
						$('#pkqt_days').addClass('disable_a_href');
						document.getElementById("pkqt_days").value = 0;

						var length = parseFloat(document.getElementById("pkqt_length").value) || 0;
						var height = parseFloat(document.getElementById("pkqt_height").value) || 0;
						var width = parseFloat(document.getElementById("pkqt_width").value) || 0;
						var rate = parseFloat(document.getElementById("pkqt_rate").value) || 0;
						var quantity = parseInt(document.getElementById("pkqt_quantity").value) || 0;
						var cft = length * width * quantity;
                    	document.getElementById("pkqt_cft").value=cft.toFixed(2)

						var length_req = parseFloat(document.getElementById("pkqt_length_req").value) || 0;
						var width_req = parseFloat(document.getElementById("pkqt_width_req").value) || 0;
						var quantity_req = parseFloat(document.getElementById("pkqt_quantity_req").value) || 0;
						var cft_req = length_req * width_req * quantity_req;
						document.getElementById("pkqt_sqrt_req").value = cft_req.toFixed(2);

						var totalCost = rate * cft_req;
						document.getElementById("pkqt_total_cost").value = totalCost.toFixed(2);
 						var totalboxCost = totalCost * quantity;
                    	document.getElementById("pkqt_totalbox_cost").value=totalboxCost.toFixed(2)
                }

                else if (jn1 == 2)
                {
                    $('#pkqt_item').removeClass('disable_a_href');
                    $('#pkqt_itemdescription').removeClass('disable_a_href');
                    $('#pkqt_stock_description').removeClass('disable_a_href');
                    $('#pkqt_length').addClass('disable_a_href');
                    $('#pkqt_width').addClass('disable_a_href');
                    $('#pkqt_height').addClass('disable_a_href');
    <!--				$('#pkqt_uom').removeClass('disable_a_href');-->
                    $('#pkqt_quantity').removeClass('disable_a_href');
                    $('#pkqt_sqrt_req').addClass('disable_a_href');
    <!--				$('#pkqt_size').removeClass('disable_a_href');-->
                    $('#pkqt_cft').addClass('disable_a_href');
                    document.getElementById("pkqt_cft").value=0;
                    document.getElementById("pkqt_length").value=0;
                    document.getElementById("pkqt_width").value=0;
                    document.getElementById("pkqt_height").value=0;
                    $('#pkqt_rate').removeClass('disable_a_href');
                    $('#pkqt_days').addClass('disable_a_href');
                    var rate = parseFloat(document.getElementById("pkqt_rate").value) || 0;
                    var quantity = parseInt(document.getElementById("pkqt_quantity").value) || 0;
                    var totalCost = rate  * quantity;
                    document.getElementById("pkqt_total_cost").value=totalCost.toFixed(2);
 					var totalboxCost = totalCost * quantity;
                   	document.getElementById("pkqt_totalbox_cost").value=totalboxCost.toFixed(2)

					var stock_desc = document.getElementById("pkqt_stock_description").value;
					if (stock_desc == 14 || stock_desc == 15 || stock_desc == 23 || stock_desc == 38 || stock_desc == 39 || stock_desc == 44 || stock_desc == 45 || stock_desc == 46) {
						var len_ft = parseFloat(document.getElementById("length_ft").value) || 0;
						var wid_ft = parseFloat(document.getElementById("width_ft").value) || 0;
						var heig_ft = parseFloat(document.getElementById("height_ft").value) || 0;
						var quantity_req = parseFloat(document.getElementById("pkqt_quantity_req").value) || 0;

						var sqft = ((len_ft * wid_ft * 2) + (wid_ft * heig_ft * 2) + (len_ft * heig_ft * 2)) * quantity_req;
						document.getElementById("pkqt_sqrt_req").value = sqft.toFixed(2);

						var totalCost = rate * sqft;
						document.getElementById("pkqt_total_cost").value = totalCost.toFixed(2);
						var totalboxCost = totalCost * quantity;
                    	document.getElementById("pkqt_totalbox_cost").value=totalboxCost.toFixed(2)

					}
					else if (stock_desc == 35) {
						var len_ft = parseFloat(document.getElementById("length_ft").value) || 0;
						var wid_ft = parseFloat(document.getElementById("width_ft").value) || 0;

						var sqft = len_ft * wid_ft * 2;
						document.getElementById("pkqt_sqrt_req").value = sqft.toFixed(2);

						var totalCost = rate  * sqft;
                    	document.getElementById("pkqt_total_cost").value=totalCost.toFixed(2);
                    	var totalboxCost = totalCost * quantity;
                    	document.getElementById("pkqt_totalbox_cost").value=totalboxCost.toFixed(2)

					}
					else if (stock_desc == 6 || stock_desc == 47) {
						var wid_ft = parseFloat(document.getElementById("width_ft").value) || 0;
						var heig_ft = parseFloat(document.getElementById("height_ft").value) || 0;
						var quantity_req = parseFloat(document.getElementById("pkqt_quantity_req").value) || 0;

						var sqft = (wid_ft * 2 + heig_ft * 2) * quantity_req;
						document.getElementById("pkqt_sqrt_req").value = sqft.toFixed(2);

						var totalCost = rate * sqft;
						document.getElementById("pkqt_total_cost").value = totalCost.toFixed(2);
						var totalboxCost = totalCost * quantity;
                    	document.getElementById("pkqt_totalbox_cost").value=totalboxCost.toFixed(2)

						}
						else{
						var quantity_req = parseFloat(document.getElementById("pkqt_quantity_req").value) || 0;
						var totalCost = rate * quantity_req;
						document.getElementById("pkqt_total_cost").value = totalCost.toFixed(2);
						var totalboxCost = totalCost * quantity;
                    	document.getElementById("pkqt_totalbox_cost").value=totalboxCost.toFixed(2)
						}
  				  }
            }
            else if (jn==4)
            {
                $('#pkqt_stock_type').addClass('disable_a_href');
                $('#pkqt_stock_description').addClass('disable_a_href');
                document.getElementById("pkqt_stock_type").value=""
                document.getElementById("pkqt_stock_description").value=""
                $('#pkqt_length').addClass('disable_a_href');
                $('#pkqt_width').addClass('disable_a_href');
                $('#pkqt_height').addClass('disable_a_href');
                $('#pkqt_days').removeClass('disable_a_href');
                $('#pkqt_uom').addClass('disable_a_href');
<!--                $('#pkqt_cft_req').addClass('disable_a_href');-->
    <!--			$('#pkqt_size').addClass('disable_a_href');-->
                document.getElementById("pkqt_uom").value="";
    <!--			document.getElementById("pkqt_size").value=0;-->
                var rate = parseFloat(document.getElementById("pkqt_rate").value) || 0;
                var quantity = parseInt(document.getElementById("pkqt_quantity").value) || 0;
                var days = parseInt(document.getElementById("pkqt_days").value) || 0;
                var totalCost = rate  * days * quantity;
                document.getElementById("pkqt_total_cost").value=totalCost.toFixed(2)
             	var totalboxCost = totalCost * quantity;
                document.getElementById("pkqt_totalbox_cost").value=totalboxCost.toFixed(2)

				var length_req = parseFloat(document.getElementById("pkqt_length_req").value) || 0;
                var width_req = parseFloat(document.getElementById("pkqt_width_req").value) || 0;
                var quantity_req = parseFloat(document.getElementById("pkqt_quantity_req").value) || 0;
                var sqft_req = length_req * width_req * quantity_req;
                document.getElementById("pkqt_sqrt_req").value=sqft_req.toFixed(2)
            }
            else if (jn==5)
            {
                $('#pkqt_stock_type').addClass('disable_a_href');
                $('#pkqt_stock_description').addClass('disable_a_href');
                document.getElementById("pkqt_stock_type").value=""
                document.getElementById("pkqt_stock_description").value=""
                $('#pkqt_length').addClass('disable_a_href');
                $('#pkqt_width').addClass('disable_a_href');
                $('#pkqt_height').addClass('disable_a_href');
                $('#pkqt_days').addClass('disable_a_href');
                $('#pkqt_uom').addClass('disable_a_href');
    <!--			$('#pkqt_size').addClass('disable_a_href');-->
                document.getElementById("pkqt_days").value=0;
                document.getElementById("pkqt_uom").value="";
    <!--			document.getElementById("pkqt_size").value=0;-->
                var rate = parseFloat(document.getElementById("pkqt_rate").value) || 0;
                var quantity = parseInt(document.getElementById("pkqt_quantity").value) || 0;
                var totalCost = rate * quantity;
                document.getElementById("pkqt_total_cost").value=totalCost.toFixed(2)
                var totalboxCost = totalCost * quantity;
                document.getElementById("pkqt_totalbox_cost").value=totalboxCost.toFixed(2)
            }
            else if (jn==6)
            {
                $('#pkqt_stock_type').addClass('disable_a_href');
                $('#pkqt_stock_description').addClass('disable_a_href');
                document.getElementById("pkqt_stock_type").value=""
                document.getElementById("pkqt_stock_description").value=""
                $('#pkqt_length').addClass('disable_a_href');
                $('#pkqt_width').addClass('disable_a_href');
                $('#pkqt_height').addClass('disable_a_href');
                $('#pkqt_days').addClass('disable_a_href');
                $('#pkqt_uom').addClass('disable_a_href');
    <!--			$('#pkqt_size').addClass('disable_a_href');-->
                document.getElementById("pkqt_uom").value="";
    <!--			document.getElementById("pkqt_size").value=0;-->
                document.getElementById("pkqt_days").value=0;
                var rate = parseFloat(document.getElementById("pkqt_rate").value) || 0;
                var quantity = parseInt(document.getElementById("pkqt_quantity").value) || 0;
                var totalCost = rate * quantity;
                document.getElementById("pkqt_total_cost").value=totalCost.toFixed(2)
                var totalboxCost = totalCost * quantity;
                document.getElementById("pkqt_totalbox_cost").value=totalboxCost.toFixed(2)
            }
            else if (jn==7)
            {
                $('#pkqt_stock_type').addClass('disable_a_href');
                $('#pkqt_stock_description').addClass('disable_a_href');
                document.getElementById("pkqt_stock_type").value=""
                document.getElementById("pkqt_stock_description").value=""
                $('#pkqt_length').addClass('disable_a_href');
                $('#pkqt_width').addClass('disable_a_href');
                $('#pkqt_height').addClass('disable_a_href');
                $('#pkqt_days').addClass('disable_a_href');
                $('#pkqt_quantity').addClass('disable_a_href');
                $('#pkqt_cft').addClass('disable_a_href');
                $('#pkqt_uom').addClass('disable_a_href');
    <!--			$('#pkqt_size').addClass('disable_a_href');-->
                document.getElementById("pkqt_days").value=0;
                document.getElementById("pkqt_quantity").value=0;
                document.getElementById("pkqt_cft").value=0;
                document.getElementById("pkqt_uom").value="";
    <!--			document.getElementById("pkqt_size").value=0;-->
                var rate = parseFloat(document.getElementById("pkqt_rate").value) || 0;
                var totalCost = rate;
                document.getElementById("pkqt_total_cost").value=totalCost.toFixed(2)
                var totalboxCost = totalCost * quantity;
                document.getElementById("pkqt_totalbox_cost").value=totalboxCost.toFixed(2)
            }
            else
            {
                $('#pkqt_stock_type').addClass('disable_a_href');
                $('#pkqt_stock_description').addClass('disable_a_href');
                document.getElementById("pkqt_stock_type").value=""
                document.getElementById("pkqt_stock_description").value=""
                $('#pkqt_length').addClass('disable_a_href');
                $('#pkqt_width').addClass('disable_a_href');
                $('#pkqt_height').addClass('disable_a_href');
                $('#pkqt_days').removeClass('disable_a_href');
                $('#pkqt_cft').addClass('disable_a_href');
                $('#pkqt_uom').addClass('disable_a_href');
    <!--			$('#pkqt_size').addClass('disable_a_href');-->
                document.getElementById("pkqt_uom").value="";
    <!--			document.getElementById("pkqt_size").value=0;-->
                document.getElementById("pkqt_cft").value=0;
                var rate = parseFloat(document.getElementById("pkqt_rate").value) || 0;
                var quantity = parseInt(document.getElementById("pkqt_quantity").value) || 0;
                var days = parseInt(document.getElementById("pkqt_days").value) || 0;
                var totalCost = rate  * days * quantity;
                document.getElementById("pkqt_total_cost").value=totalCost.toFixed(2)
 				var totalboxCost = totalCost * quantity;
                document.getElementById("pkqt_totalbox_cost").value=totalboxCost.toFixed(2)
            }
        }
</script>

<script>
	function change_charge_type() {
        var jn=document.getElementById("pkqt_stock_type").value
        if ( jn==1)
        {
            $('#pkqt_stock_description').removeClass('disable_a_href');
    <!--		$('#pkqt_length').removeClass('disable_a_href');-->
    <!--		$('#pkqt_width').removeClass('disable_a_href');-->
    <!--		$('#pkqt_height').removeClass('disable_a_href');-->
            $('#pkqt_uom').addClass('disable_a_href');
            $('#pkqt_quantity').removeClass('disable_a_href');
    <!--		$('#pkqt_size').addClass('disable_a_href');-->
    <!--		document.getElementById("pkqt_size").value=parseFloat(0.0)-->
            $('#pkqt_days').addClass('disable_a_href');
            document.getElementById("pkqt_days").value=0;

            var length = parseFloat(document.getElementById("pkqt_length").value) || 0;
            var height = parseFloat(document.getElementById("pkqt_height").value) || 0;
            var width = parseFloat(document.getElementById("pkqt_width").value) || 0;
            var rate = parseFloat(document.getElementById("pkqt_rate").value) || 0;
            var quantity = parseInt(document.getElementById("pkqt_quantity").value) || 0;
            var cft = (length*height*width/144)*quantity;
            document.getElementById("pkqt_cft").value=cft.toFixed(2)
            var totalCost = rate * cft;
            document.getElementById("pkqt_total_cost").value=totalCost.toFixed(2)
        }

        else if (jn==2)
        {
            $('#pkqt_stock_description').removeClass('disable_a_href');
            $('#pkqt_length').addClass('disable_a_href');
            $('#pkqt_width').addClass('disable_a_href');
            $('#pkqt_height').addClass('disable_a_href');
    <!--		$('#pkqt_uom').removeClass('disable_a_href');-->
            $('#pkqt_quantity').removeClass('disable_a_href');
    <!--		$('#pkqt_size').removeClass('disable_a_href');-->
            $('#pkqt_cft').addClass('disable_a_href');
            document.getElementById("pkqt_cft").value=0;
            document.getElementById("pkqt_length").value=0;
            document.getElementById("pkqt_width").value=0;
            document.getElementById("pkqt_height").value=0;
            $('#pkqt_rate').removeClass('disable_a_href');
            $('#pkqt_days').addClass('disable_a_href');
            var rate = parseFloat(document.getElementById("pkqt_rate").value) || 0;
            var quantity = parseInt(document.getElementById("pkqt_quantity").value) || 0;
            var totalCost = rate  * quantity;
            document.getElementById("pkqt_total_cost").value=totalCost.toFixed(2)
        }
    }
</script>

<script>
	function search_wood() {
    var stock_description = $("#pkqt_stock_description").val();
    var stock_type = $("#pkqt_stock_type").val();
    var length_req = parseFloat($("#pkqt_length_req").val());
    var width_req = parseFloat($("#pkqt_width_req").val());
    var height_req = parseFloat($("#pkqt_height_req").val());
    var includeContainer = $('#pk_item_search_page_costing');

    $.ajax({
        url: '{% url "pk_item_search_page_costing" %}',  // Ensure the correct URL here
        data: {
            'stock_type': stock_type,
            'stock_description': stock_description,
            'length_req': length_req,
            'width_req': width_req,
            'height_req': height_req,
        },
        success: function (results) {
            console.log("Results:", results);  // Debug: Check the data structure

            if (results.length === 0) {
                $('#unique_field_error').text('No stock found for the given criteria.');
                return;
            }

            // Sorting logic (optional)
            results.sort(function (a, b) {
                return a.sp_length_reduced - b.sp_length_reduced;  // Example sorting by length
            });

            // Generate HTML for the table
            var tableHtml = '<table id="stockTable" class="table table-striped table-bordered">';
            tableHtml += '<thead class="thead-dark">';
            tableHtml += '<tr>';
            tableHtml += '<th>ID</th>';
            tableHtml += '<th>Vendor Bill</th>';
            tableHtml += '<th>Date</th>';
            tableHtml += '<th>Stock Purchases Number</th>';
            tableHtml += '<th>Category</th>';
            tableHtml += '<th>Stock Type</th>';
            tableHtml += '<th>Stock Description</th>';
            tableHtml += '<th>Source</th>';
            tableHtml += '<th>Thick/Height</th>';
            tableHtml += '<th>Width</th>';
            tableHtml += '<th>Length</th>';
            tableHtml += '<th>CFT</th>';
            tableHtml += '<th>Quantity</th>';
            tableHtml += '<th>Rate/Qty (CFT)</th>';
            tableHtml += '<th>UOM</th>';
            tableHtml += '<th>Size</th>';
            tableHtml += '<th>Select</th>';
            tableHtml += '</tr>';
            tableHtml += '</thead>';
            tableHtml += '<tbody>';

            for (var i = 0; i < results.length; i++) {
                tableHtml += '<tr>';
                tableHtml += '<td>' + results[i].id + '</td>';
                tableHtml += '<td>' + results[i].sp_vendor_bill + '</td>';
                tableHtml += '<td>' + results[i].sp_stock_in_date + '</td>';
                tableHtml += '<td>' + results[i].sp_purchase_num + '</td>';
                tableHtml += '<td>' + results[i].sp_category__category + '</td>';
                tableHtml += '<td>' + results[i].sp_stock_type__pk_stocktype + '</td>';
                tableHtml += '<td>' + results[i].sp_stock_description__stock_description + '</td>';
                tableHtml += '<td>' + results[i].sp_source__source + '</td>';
                tableHtml += '<td>' + results[i].sp_thick_height_reduced + '</td>';
                tableHtml += '<td>' + results[i].sp_width_reduced + '</td>';
                tableHtml += '<td>' + results[i].sp_length_reduced + '</td>';
                tableHtml += '<td>' + results[i].sp_cft_reduced + '</td>';
                tableHtml += '<td>' + results[i].sp_quantity_reduced + '</td>';
                tableHtml += '<td>' + results[i].sp_rate + '</td>';
                tableHtml += '<td>' + results[i].sp_uom__unit_of_measure + '</td>';
                tableHtml += '<td>' + results[i].sp_size + '</td>';
                tableHtml += '<td><a class="btn btn-primary"><i class="far fa-edit"></i> Select</a></td>';
                tableHtml += '</tr>';
            }
            tableHtml += '</tbody></table>';

            // Set the table HTML to the includeContainer inside the modal
            includeContainer.html(tableHtml);

            // Initialize DataTable after rendering the table
            $('#stockTable').DataTable();
        }
    });

    // Attach click event to the "Select" button inside the modal
    includeContainer.on('click', 'a.btn-primary', function (e) {
        e.preventDefault();

        var selectedRow = $(this).closest('tr');
        var stockId = selectedRow.find('td:eq(0)').text();
        var height = selectedRow.find('td:eq(8)').text();
        var width = selectedRow.find('td:eq(9)').text();
        var length = selectedRow.find('td:eq(10)').text();
        var cft = selectedRow.find('td:eq(11)').text();
        var quantity = selectedRow.find('td:eq(12)').text();
        var rateCFT = selectedRow.find('td:eq(13)').text();
        var uom_id = selectedRow.find('.hidden-column').text();

        $("#pkqt_stock_purchase_number").val(stockId);
        $("#pkqt_length").val(length);
        $("#pkqt_width").val(width);
        $("#pkqt_height").val(height);
        $("#pkqt_cft").val(cft);
        $("#pkqt_quantity").val(quantity);
        $("#pkqt_rate").val(rateCFT);
        $("#pkqt_uom").val(uom_id);

        change_cost_type();  // Custom function
    });
}
</script>
<script>
	function changeItemDescription() {
    var item_id = $('#pkqt_item').val();
    $.ajax({
        url: '{% url 'pk_get_item_description' %}',
        type: 'GET',
        data: {'item_id': item_id},
        dataType: 'json',
        success: function(data) {
            console.log("Data",data);
			$('#pkqt_itemdescription').removeClass('disable_a_href');
			$('#pkqt_itemdescription').empty();
			$('#pkqt_itemdescription').empty().append("<option value='0'>--Select--</option>");
        	var pkqt_itemdescription_name=data.item_description_val;
        	var pkqt_itemdescription_id=data.item_description_id;
        	var len = (pkqt_itemdescription_id).length;
        	$('#pkqt_itemdescription').empty().append("<option value='0'>--Select--</option>");
        	for( var i = 0; i<len; i++){
        		$("#pkqt_itemdescription").append("<option value='"+pkqt_itemdescription_id[i]+"'>"+pkqt_itemdescription_name[i]+"</option>");
			}
        }
    });
}
</script>

<script>
	function load_pk_requirement_type() {
    var pkqt_assessment_num_id = $('#pkqt_assessment_num').val();
    $.ajax({
        url: '{% url 'pk_get_pk_requirement_type' %}',
        type: 'GET',
        data: {'ct_assessment_num_id': pkqt_assessment_num_id},
        dataType: 'json',
        success: function(data) {
        	$('#pkqt_requirement').removeClass('disable_a_href');
        	$('#pkqt_requirement').empty();
			$('#pkqt_requirement').empty().append("<option value='0'>--Select--</option>");
        	var pkqt_requirement_name=data.requirement_type_val;
        	var pkqt_requirement_id=data.requirement_type_id;
        	var len = (pkqt_requirement_id).length;
        	$('#pkqt_requirement').empty().append("<option value='0'>--Select--</option>");
        	for( var i = 0; i<len; i++){
        		$("#pkqt_requirement").append("<option value='"+pkqt_requirement_id[i]+"'>"+pkqt_requirement_name[i]+"</option>");
			}
        }
    });
}
</script>

<script>
	function pk_store_na_dimension_id() {
        var pkqt_requirement_id = $('#pkqt_requirement').val();
        $.ajax({
            url: '{% url "pk_store_na_dimension_id" %}',
            type: 'GET',
            data: {'ct_requirement_id': pkqt_requirement_id},
            dataType: 'json',
            success: function(data) {
                var na_dimension_box_val = data.na_dimension_box_val;
                var na_dimension_type_val = data.na_dimension_type;
                document.getElementById("pkqt_requirement_size").value = na_dimension_box_val;
               	var na_dimension_type_val = data.na_dimension_type;
                var na_dimension_type_id_val = data.na_dimension_type_id;
                document.getElementById("pkqt_dimension_type").value = na_dimension_type_val;
                document.getElementById("pkqt_dimension_type_id").value = na_dimension_type_id_val;
                var na_uom_val = data.na_uom;
                var na_uom_id_val = data.na_uom_id;
                document.getElementById("pkqt_uom_calc").value = na_uom_val;
                var l = parseFloat(data.na_length);
                document.getElementById("pkqt_l").value = l;
                var w = parseFloat(data.na_width);
                document.getElementById("pkqt_w").value = w;
                var h = parseFloat(data.na_height);
                document.getElementById("pkqt_h").value = h;
                calculateDimensions(na_uom_id_val,l,w,h);
            }
        });
    }
</script>

<script>
	function onChangeHandler() {
        change_cost_type();
        load_pk_requirement_type();
    }
</script>


{% endblock content %}