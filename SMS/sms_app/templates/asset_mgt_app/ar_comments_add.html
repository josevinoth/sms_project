{% extends "asset_mgt_app/base.html" %}
{% load widget_tweaks %}
{% block content %}
<div class="col-md-1">
	<a href="{% url 'ar_comments_list' %}" class="btn btn-primary btn-block btn-lg">
		<i class="fas fa-arrow-left"></i> Back
	</a>
</div>
<form method="POST" action="">
	{% csrf_token %}
	<div class="row">
		<div class="col-3"></div>
		<div class="col-6">
			<div class="container-fluid">
				<div class="card text-white bg-info mb-3" style="max-width: 100%;">
					<div class="card-header text-center"><h3>Add/Update AR Comments</h3></div>
					<div class="card-body bg-light" >
						<div class="row">
							<div class="col">
								<div class="input-group input-group-sm mb-3">
									<div class="input-group-prepend">
										<span class="input-group-text">Invoice Number</span>
									</div>
									{% render_field Ar_comments_form.arc_invoice_num id="arc_invoice_num" Readonly="True" class="form-control" %}
								</div>
								<div class="input-group input-group-sm mb-3">
									<div class="input-group-prepend">
										<span class="input-group-text">Customer Name</span>
									</div>
									{% render_field Ar_comments_form.arc_customer id="arc_customer" class="form-control" %}
								</div>
								{% render_field Ar_comments_form.arc_updated_by id="arc_updated_by" hidden="True" class="form-control" %}
								{% render_field Ar_comments_form.arc_invoice_list id="arc_invoice_list" hidden="True" class="form-control" %}
								<div class="input-group input-group-sm mb-3">
									<div class="input-group-prepend">
										<span class="input-group-text">Customer Contact Name</span>
									</div>
									{% render_field Ar_comments_form.arc_customer_contact_name id="arc_customer_contact_name" class="form-control" %}
								</div>
								<div class="input-group input-group-sm mb-3">
									<div class="input-group-prepend">
										<span class="input-group-text">Contact Designation</span>
									</div>
									{% render_field Ar_comments_form.arc_customer_contact_designation id="arc_customer_contact_designation" class="form-control" %}
								</div>
								<div class="input-group input-group-sm mb-3">
									<div class="input-group-prepend">
										<span class="input-group-text">Comments</span>
									</div>
									{% render_field Ar_comments_form.arc_comments id="arc_comments" class="form-control" %}
								</div>
							</div>
						</div>
						<div class="row">
							<div class="col-1"></div>
							<div class="col-10">
								<div class="message text-center">
									{% for message in messages %}
									<a {% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</a>
									{% endfor %}
								</div>
							</div>
							<div class="col-1"></div>
						</div>
						<button type="submit" class="btn btn-success" id="save-btn" ><i class="fas fa-check"></i> Submit</button>
						<a href="{% url 'ar_comments_list' %}" class="btn btn-danger float-right">
							<i class="fas fa-times"></i> Cancel
						</a>
					</div>
				</div>
			</div>
		</div>
		<div class="col-3"></div>
	</div>
</form>

<!--	Ar comments Table-->
<div class="container-fluid">
	<table  id="ar_invoice_list" class="table table-striped table-bordered">
		<thead class="thead-dark">
		<tr>
			<th></th>
			<th>ID</th>
			<th>Invoice Number</th>
			<th>Customer</th>
		</thead>
		<tbody>
		{% for ar_invoiceinfo in ar_invoice_list %}
		<tr>
			<td></td>
			<td> {{ar_invoiceinfo.id}}</td>
			<td> {{ar_invoiceinfo.ar_invoice_num}}</td>
			<td> {{ar_invoiceinfo.ar_customer_name}}</td>
		</tr>
		{% endfor %}
		</tbody>
	</table>
</div>
<script>
$(document).ready(function (){
	document.getElementById("arc_updated_by").value ={{user_id}};
  var table=new DataTable('#ar_invoice_list', {
    columnDefs: [
        {
            orderable: false,
            className: 'select-checkbox',
            targets: 0
        }
    ],
    select: {
        style: 'os',
        selector: 'td:first-child'
    },
    order: [[1, 'asc']]
});

   // Handle form submission event
   $('#save-btn').on('click', function(){
      	var rows_selected = table.column(0).selected();
      	let selectedValues = table.rows( { selected: true } ).data();
      	var len1=( selectedValues ).length;
      	console.log( len1 );
      	var len=( selectedValues[0] ).length;
      	console.log( selectedValues );
      	console.log( selectedValues[0] );
      	console.log( len );
      	var elements = [];
      	for (var i = 0; i < len1; i++) {
				console.log(selectedValues[i][2]);
				elements.push(selectedValues[i][2]);
			}
		document.getElementById("arc_invoice_num").value=elements;
     });
	invoice=document.getElementById("arc_invoice_num").value
	if (invoice=="")
		{
			document.getElementById("arc_invoice_num").value =elements;
		}
		else
		{
			document.getElementById("arc_invoice_num").value =invoice;
			$('#ar_invoice_list').parents('div.dataTables_wrapper').first().hide();
		}
});
</script>

{% endblock content %}